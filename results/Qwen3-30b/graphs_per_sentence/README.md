# AMoC Graphs for each sentence of the story text

This folder contains per-sentence graph snapshots generated by AMoC for the Qwen3-30B model for the following text:
```
A young knight rode through the forest. The knight was unfamiliar with the country. Suddenly, a dragon appeared. The dragon was kidnapping a beautiful princess. The knight wanted to free the princess. The knight wanted to marry the princess. The knight hurried after the dragon. The knight and the dragon fought for life and death. Soon, the knight's armor was completely scorched. At last, the knight killed the dragon. The knight freed the princess. The princess was very thankful to the knight. The princess married the knight.
```
This demo uses 8 personas—2 per educational regime (primary, secondary, high school, university)—to show how triplet extraction progresses. Ages: 8, 12, 16, 18.

## 1. Plot progression
- File are under **results/Qwen3-30b/graphs_per_sentence/[8, 12, 16, 18] y:o**; filenames include persona/model/sentence for a specific age(e.g., `amoc_graph_<model>_<persona>_<age>_sentN.png`).
- For a grid-like view of a sentence across different personas and ages, see **results/Qwen3-30b/graphs_per_sentence/comparison_across_ages/grid_comparison**: The grids are organized by 'sentN'. One can notice that not all grids have 8 snapshots. This is because for a given persona/sentence, if all edges are inactive (or filtered out) the graph is empty and that sentence’s PNG is skipped, which creates gaps in the sequence. In *_plot_graph_snapshot* we call *plot_amoc_triplets* with *only_active=True*; then graph_plots removes isolates and, if no nodes remain, just returns without writing a file. 

## 2. Final Plots (Plots for Sentence 12)

**Note**:
- Snapshots are cumulative across sentences; the last sentence plot reflects the final graph state for that persona.

The plotting evolved from the original (v1) code to the current (v3) codebase:

- **v1.png**: Plots for the final sentence produced by the old code. These showed all edges - including the inactive ones, no component pruning and outliers.
![Sentence 12 across different personas- v1](/results/Qwen3-30b/graphs_per_sentence/old_code/v1_12.png)
- **v2.png**: Plots for the final sentence from the updated code. Key change - largest-component-only with isolate removal (except when explicitly disabled for debugging), so disconnected fragments are hidden.
![Sentence 12 across different personas- v2](/results/Qwen3-30b/graphs_per_sentence/old_code/v2_12.png)
- **v3+.png**: Plots for the final sentence from the updated code. Key changes:
  - Generic relation filtering (e.g., drop `has_property`, `is_type_of`) to reduce schema/noise.
  - Active-only edge plotting: only edges that remain active after fading/reactivation are shown.
  - Largest-component-only with isolate removal (except when explicitly disabled for debugging), hiding disconnected fragments.
  - Layout tweaks: multi-edges kept but drawn with curvature; radial-ish positioning with the highest-degree node central.
  
![Sentence 12 across different personas- v3](/results/Qwen3-30b/graphs_per_sentence/comparison_across_ages/grid_comparison/sent12.png)

Observations on noise reduction:
- Plots are cleaner and more story-grounded after adding the generic-label filter and, in some runs, restricting prompts to text-based context.
- Those runs where we briefly disabled isolate/component pruning have gaps or extra components.

## 2. Triplets 
Related outputs:
- In `results/Qwen3-30b/extracted_triplets/` you can find CSVs with example triplets from larger batches. These are the final active edges returned by the new pipeline.
- With a limited sample, it’s hard to claim linear trends across educational stages; preliminarily, the number of triplets appears persona-dependent.


